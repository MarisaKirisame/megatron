auto x_50(const auto &x_51) {
  return MakeNode(JsonToString(JsonMember("name", x_51)), JsonToDict(JsonMember("attributes", x_51)),
                  JsonToDict(JsonMember("properties", x_51)), JsonToInt(JsonMember("id", x_51)),
                  ListMap(JsonToList(JsonMember("children", x_51)), [&](const auto &x_52) { return x_50(x_52); }));
}
auto json_to_node_aux_x_0(const auto &x_51) { return x_50(x_51); }
auto x_53(const auto &x_54) {
  return MakeNode(x_54.name, x_54.attr, x_54.prop, x_54.extern_id,
                  ListMap(x_54.children, [&](const auto &x_55) { return x_53(x_55); }));
}
auto node_to_fs_node_x_1(const auto &x_54) { return x_53(x_54); }
auto x_56(const auto &x_57) {
  return MakeLayoutNode(
      ListMap(JsonToList(JsonMember("children", x_57)), [&](const auto &x_58) { return x_56(x_58); }));
}
auto json_to_layout_node_x_2(const auto &x_57) { return x_56(x_57); }
auto x_59(const auto &x_60) {
  return IntAdd(1, ListIntSum(x_60.children, [&](const auto &x_61) { return x_59(x_61); }));
}
auto layout_size_x_3(const auto &x_60) { return x_59(x_60); }
auto x_62(const auto &x_63) {
  return IntAdd(1, ListIntSum(x_63.children, [&](const auto &x_64) { return x_62(x_64); }));
}
auto node_size_x_4(const auto &x_63) { return x_62(x_63); }
auto x_65(const auto &x_66) {
  auto x_67 = Zro(x_66);
  auto x_68 = Fst(x_66);
  auto x_69 = Zro(x_67);
  auto x_70 = Fst(x_67);return ListMatch(x_69,[&](const auto&x_147){
    return Panic();},[&](const auto&x_71){
  return [&](const auto &x_72) {return ListMatch(x_72,[&](const auto&x_75){auto x_76 = Zro(x_68);auto x_77 = Fst(x_68);InputChangeMetric(x_77,node_size_x_4(x_76));auto x_78 = ListSplitN(x_70.children,x_71);auto x_79 = Zro(x_78);auto x_80 = Fst(x_78);x_70.children=ListAppend(x_79,Cons(x_76,x_80));OptionMatch(ListLast(x_79),[&](const auto&x_82){x_76.prev=None();},[&](const auto&x_81){x_76.prev=Some(x_81);x_81.next=Some(x_76);});OptionMatch(ListHead(x_80),[&](const auto&x_84){x_76.next=None();},[&](const auto&x_83){x_76.next=Some(x_83);x_83.prev=Some(x_76);});x_76.parent=Some(x_70);OptionMatch(x_76.next,[&](const auto&x_86){return MakeUnit();},[&](const auto&x_85){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_88){return MakeUnit();},[&](const auto&x_87){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_90){return MakeUnit();},[&](const auto&x_89){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_92){return MakeUnit();},[&](const auto&x_91){return MakeUnit();});if (IntEqual(ListLength(x_70.children),1)){}else{if (ListIsEmpty(x_80)){}else{if (IntEqual(ListLength(x_70.children),1)){}else{if (IntEqual(ListLength(x_70.children),1)){}else{OptionMatch(x_76.next,[&](const auto&x_94){return MakeUnit();},[&](const auto&x_93){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_96){return MakeUnit();},[&](const auto&x_95){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_98){return MakeUnit();},[&](const auto&x_97){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_100){return MakeUnit();},[&](const auto&x_99){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_102){return MakeUnit();},[&](const auto&x_101){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_104){return MakeUnit();},[&](const auto&x_103){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_106){return MakeUnit();},[&](const auto&x_105){return MakeUnit();});if (IntEqual(ListLength(x_70.children),1)){}else{if (ListIsEmpty(x_80)){}else{if (ListIsEmpty(x_80)){}else{if (IntEqual(ListLength(x_70.children),1)){}else{if (IntEqual(ListLength(x_70.children),1)){}else{OptionMatch(x_76.next,[&](const auto&x_108){return MakeUnit();},[&](const auto&x_107){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_110){return MakeUnit();},[&](const auto&x_109){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_112){return MakeUnit();},[&](const auto&x_111){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_114){return MakeUnit();},[&](const auto&x_113){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_116){return MakeUnit();},[&](const auto&x_115){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_118){return MakeUnit();},[&](const auto&x_117){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_120){return MakeUnit();},[&](const auto&x_119){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_122){return MakeUnit();},[&](const auto&x_121){return MakeUnit();});if (IntEqual(ListLength(x_70.children),1)){}else{if (ListIsEmpty(x_80)){}else{if (IntEqual(ListLength(x_70.children),1)){}else{if (ListIsEmpty(x_80)){}else{OptionMatch(x_76.next,[&](const auto&x_124){return MakeUnit();},[&](const auto&x_123){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_126){return MakeUnit();},[&](const auto&x_125){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_128){return MakeUnit();},[&](const auto&x_127){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_130){return MakeUnit();},[&](const auto&x_129){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_132){return MakeUnit();},[&](const auto&x_131){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_134){return MakeUnit();},[&](const auto&x_133){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_136){return MakeUnit();},[&](const auto&x_135){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_138){return MakeUnit();},[&](const auto&x_137){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_140){return MakeUnit();},[&](const auto&x_139){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_142){return MakeUnit();},[&](const auto&x_141){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_144){return MakeUnit();},[&](const auto&x_143){return MakeUnit();});OptionMatch(x_76.next,[&](const auto&x_146){return MakeUnit();},[&](const auto&x_145){return MakeUnit();});return MakeUnit();},[&](const auto&x_73){return [&](const auto&x_74){return x_65(MakePair(MakePair(x_72,ListNthExn(x_70.children,x_71)),x_68));};});};});}auto add_node_x_5(const auto&x_66){return x_65(x_66);}auto x_148(const auto&x_149){auto x_150 = Zro(x_149);auto x_151 = Fst(x_149);auto x_152 = Zro(x_150);auto x_153 = Fst(x_150);return ListMatch(x_152,[&](const auto&x_162){return Panic();},[&](const auto&x_154){return [&](const auto&x_155){return ListMatch(x_155,[&](const auto&x_158){auto x_159 = Zro(x_151);auto x_160 = Fst(x_151);OutputChangeMetric(x_160,layout_size_x_3(x_159));auto x_161 = ListSplitN(x_153.children,x_154);x_153.children=ListAppend(Zro(x_161),Cons(x_159,Fst(x_161)));},[&](const auto&x_156){return [&](const auto&x_157){return x_148(MakePair(MakePair(x_155,ListNthExn(x_153.children,x_154)),x_151));};});};});}auto add_layout_node_x_6(const auto&x_149){return x_148(x_149);}auto x_163(const auto&x_164){auto x_165 = Zro(x_164);auto x_166 = Fst(x_164);auto x_167 = Zro(x_165);auto x_168 = Fst(x_165);return ListMatch(x_167,[&](const auto&x_246){return Panic();},[&](const auto&x_169){return [&](const auto&x_170){return ListMatch(x_170,[&](const auto&x_173){InputChangeMetric(x_166,node_size_x_4(ListNthExn(x_168.children,x_169)));auto x_174 = ListSplitN(x_168.children,x_169);auto x_175 = Zro(x_174);auto x_176 = Fst(x_174);return ListMatch(x_176,[&](const auto&x_245){return Panic();},[&](const auto&x_177){return [&](const auto&x_178){OptionMatch(x_177.prev,[&](const auto&x_180){return MakeUnit();},[&](const auto&x_179){x_179.next=x_177.next;});OptionMatch(x_177.next,[&](const auto&x_182){return MakeUnit();},[&](const auto&x_181){x_181.prev=x_177.prev;});x_177.meta;x_168.children=ListAppend(x_175,x_178);OptionMatch(x_177.next,[&](const auto&x_184){return MakeUnit();},[&](const auto&x_183){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_186){return MakeUnit();},[&](const auto&x_185){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_188){return MakeUnit();},[&](const auto&x_187){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_190){return MakeUnit();},[&](const auto&x_189){return MakeUnit();});if (ListIsEmpty(x_168.children)){}else{if (ListIsEmpty(x_178)){}else{if (ListIsEmpty(x_168.children)){}else{if (ListIsEmpty(x_168.children)){}else{OptionMatch(x_177.next,[&](const auto&x_192){return MakeUnit();},[&](const auto&x_191){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_194){return MakeUnit();},[&](const auto&x_193){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_196){return MakeUnit();},[&](const auto&x_195){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_198){return MakeUnit();},[&](const auto&x_197){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_200){return MakeUnit();},[&](const auto&x_199){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_202){return MakeUnit();},[&](const auto&x_201){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_204){return MakeUnit();},[&](const auto&x_203){return MakeUnit();});if (ListIsEmpty(x_168.children)){}else{if (ListIsEmpty(x_178)){}else{if (ListIsEmpty(x_178)){}else{if (ListIsEmpty(x_168.children)){}else{if (ListIsEmpty(x_168.children)){}else{OptionMatch(x_177.next,[&](const auto&x_206){return MakeUnit();},[&](const auto&x_205){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_208){return MakeUnit();},[&](const auto&x_207){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_210){return MakeUnit();},[&](const auto&x_209){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_212){return MakeUnit();},[&](const auto&x_211){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_214){return MakeUnit();},[&](const auto&x_213){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_216){return MakeUnit();},[&](const auto&x_215){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_218){return MakeUnit();},[&](const auto&x_217){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_220){return MakeUnit();},[&](const auto&x_219){return MakeUnit();});if (ListIsEmpty(x_168.children)){}else{if (ListIsEmpty(x_178)){}else{if (ListIsEmpty(x_168.children)){}else{if (ListIsEmpty(x_178)){}else{OptionMatch(x_177.next,[&](const auto&x_222){return MakeUnit();},[&](const auto&x_221){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_224){return MakeUnit();},[&](const auto&x_223){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_226){return MakeUnit();},[&](const auto&x_225){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_228){return MakeUnit();},[&](const auto&x_227){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_230){return MakeUnit();},[&](const auto&x_229){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_232){return MakeUnit();},[&](const auto&x_231){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_234){return MakeUnit();},[&](const auto&x_233){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_236){return MakeUnit();},[&](const auto&x_235){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_238){return MakeUnit();},[&](const auto&x_237){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_240){return MakeUnit();},[&](const auto&x_239){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_242){return MakeUnit();},[&](const auto&x_241){return MakeUnit();});OptionMatch(x_177.next,[&](const auto&x_244){return MakeUnit();},[&](const auto&x_243){return MakeUnit();});return MakeUnit();};});},[&](const auto&x_171){return [&](const auto&x_172){return x_163(MakePair(MakePair(x_170,ListNthExn(x_168.children,x_169)),x_166));};});};});}auto remove_node_x_7(const auto&x_164){return x_163(x_164);}auto x_247(const auto&x_248){auto x_249 = Zro(x_248);auto x_250 = Fst(x_248);auto x_251 = Zro(x_249);auto x_252 = Fst(x_249);return ListMatch(x_251,[&](const auto&x_259){return Panic();},[&](const auto&x_253){return [&](const auto&x_254){return ListMatch(x_254,[&](const auto&x_257){OutputChangeMetric(x_250,layout_size_x_3(ListNthExn(x_252.children,x_253)));auto x_258 = ListSplitN(x_252.children,x_253);x_252.children=ListAppend(Zro(x_258),ListTailExn(Fst(x_258)));},[&](const auto&x_255){return [&](const auto&x_256){return x_247(MakePair(MakePair(x_254,ListNthExn(x_252.children,x_253)),x_250));};});};});}auto remove_layout_node_x_8(const auto&x_248){return x_247(x_248);}auto x_260(const auto&x_261){auto x_262 = Zro(x_261);auto x_263 = Fst(x_261);auto x_264 = Zro(x_262);auto x_265 = Fst(x_262);return ListMatch(x_264,[&](const auto&x_414){return Panic();},[&](const auto&x_266){return [&](const auto&x_267){return ListMatch(x_267,[&](const auto&x_270){auto x_271 = Zro(x_263);auto x_272 = Fst(x_263);InputChangeMetric(x_272,IntAdd(node_size_x_4(ListNthExn(x_265.children,x_266)),node_size_x_4(x_271)));auto x_273 = ListSplitN(x_265.children,x_266);auto x_274 = Zro(x_273);auto x_275 = Fst(x_273);ListMatch(x_275,[&](const auto&x_344){return Panic();},[&](const auto&x_276){return [&](const auto&x_277){OptionMatch(x_276.prev,[&](const auto&x_279){return MakeUnit();},[&](const auto&x_278){x_278.next=x_276.next;});OptionMatch(x_276.next,[&](const auto&x_281){return MakeUnit();},[&](const auto&x_280){x_280.prev=x_276.prev;});x_276.meta;x_265.children=ListAppend(x_274,x_277);OptionMatch(x_276.next,[&](const auto&x_283){return MakeUnit();},[&](const auto&x_282){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_285){return MakeUnit();},[&](const auto&x_284){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_287){return MakeUnit();},[&](const auto&x_286){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_289){return MakeUnit();},[&](const auto&x_288){return MakeUnit();});if (ListIsEmpty(x_265.children)){}else{if (ListIsEmpty(x_277)){}else{if (ListIsEmpty(x_265.children)){}else{if (ListIsEmpty(x_265.children)){}else{OptionMatch(x_276.next,[&](const auto&x_291){return MakeUnit();},[&](const auto&x_290){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_293){return MakeUnit();},[&](const auto&x_292){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_295){return MakeUnit();},[&](const auto&x_294){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_297){return MakeUnit();},[&](const auto&x_296){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_299){return MakeUnit();},[&](const auto&x_298){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_301){return MakeUnit();},[&](const auto&x_300){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_303){return MakeUnit();},[&](const auto&x_302){return MakeUnit();});if (ListIsEmpty(x_265.children)){}else{if (ListIsEmpty(x_277)){}else{if (ListIsEmpty(x_277)){}else{if (ListIsEmpty(x_265.children)){}else{if (ListIsEmpty(x_265.children)){}else{OptionMatch(x_276.next,[&](const auto&x_305){return MakeUnit();},[&](const auto&x_304){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_307){return MakeUnit();},[&](const auto&x_306){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_309){return MakeUnit();},[&](const auto&x_308){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_311){return MakeUnit();},[&](const auto&x_310){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_313){return MakeUnit();},[&](const auto&x_312){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_315){return MakeUnit();},[&](const auto&x_314){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_317){return MakeUnit();},[&](const auto&x_316){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_319){return MakeUnit();},[&](const auto&x_318){return MakeUnit();});if (ListIsEmpty(x_265.children)){}else{if (ListIsEmpty(x_277)){}else{if (ListIsEmpty(x_265.children)){}else{if (ListIsEmpty(x_277)){}else{OptionMatch(x_276.next,[&](const auto&x_321){return MakeUnit();},[&](const auto&x_320){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_323){return MakeUnit();},[&](const auto&x_322){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_325){return MakeUnit();},[&](const auto&x_324){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_327){return MakeUnit();},[&](const auto&x_326){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_329){return MakeUnit();},[&](const auto&x_328){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_331){return MakeUnit();},[&](const auto&x_330){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_333){return MakeUnit();},[&](const auto&x_332){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_335){return MakeUnit();},[&](const auto&x_334){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_337){return MakeUnit();},[&](const auto&x_336){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_339){return MakeUnit();},[&](const auto&x_338){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_341){return MakeUnit();},[&](const auto&x_340){return MakeUnit();});OptionMatch(x_276.next,[&](const auto&x_343){return MakeUnit();},[&](const auto&x_342){return MakeUnit();});return MakeUnit();};});auto x_345 = ListSplitN(x_265.children,x_266);auto x_346 = Zro(x_345);auto x_347 = Fst(x_345);x_265.children=ListAppend(x_346,Cons(x_271,x_347));OptionMatch(ListLast(x_346),[&](const auto&x_349){x_271.prev=None();},[&](const auto&x_348){x_271.prev=Some(x_348);x_348.next=Some(x_271);});OptionMatch(ListHead(x_347),[&](const auto&x_351){x_271.next=None();},[&](const auto&x_350){x_271.next=Some(x_350);x_350.prev=Some(x_271);});x_271.parent=Some(x_265);OptionMatch(x_271.next,[&](const auto&x_353){return MakeUnit();},[&](const auto&x_352){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_355){return MakeUnit();},[&](const auto&x_354){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_357){return MakeUnit();},[&](const auto&x_356){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_359){return MakeUnit();},[&](const auto&x_358){return MakeUnit();});if (IntEqual(ListLength(x_265.children),1)){}else{if (ListIsEmpty(x_347)){}else{if (IntEqual(ListLength(x_265.children),1)){}else{if (IntEqual(ListLength(x_265.children),1)){}else{OptionMatch(x_271.next,[&](const auto&x_361){return MakeUnit();},[&](const auto&x_360){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_363){return MakeUnit();},[&](const auto&x_362){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_365){return MakeUnit();},[&](const auto&x_364){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_367){return MakeUnit();},[&](const auto&x_366){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_369){return MakeUnit();},[&](const auto&x_368){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_371){return MakeUnit();},[&](const auto&x_370){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_373){return MakeUnit();},[&](const auto&x_372){return MakeUnit();});if (IntEqual(ListLength(x_265.children),1)){}else{if (ListIsEmpty(x_347)){}else{if (ListIsEmpty(x_347)){}else{if (IntEqual(ListLength(x_265.children),1)){}else{if (IntEqual(ListLength(x_265.children),1)){}else{OptionMatch(x_271.next,[&](const auto&x_375){return MakeUnit();},[&](const auto&x_374){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_377){return MakeUnit();},[&](const auto&x_376){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_379){return MakeUnit();},[&](const auto&x_378){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_381){return MakeUnit();},[&](const auto&x_380){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_383){return MakeUnit();},[&](const auto&x_382){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_385){return MakeUnit();},[&](const auto&x_384){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_387){return MakeUnit();},[&](const auto&x_386){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_389){return MakeUnit();},[&](const auto&x_388){return MakeUnit();});if (IntEqual(ListLength(x_265.children),1)){}else{if (ListIsEmpty(x_347)){}else{if (IntEqual(ListLength(x_265.children),1)){}else{if (ListIsEmpty(x_347)){}else{OptionMatch(x_271.next,[&](const auto&x_391){return MakeUnit();},[&](const auto&x_390){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_393){return MakeUnit();},[&](const auto&x_392){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_395){return MakeUnit();},[&](const auto&x_394){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_397){return MakeUnit();},[&](const auto&x_396){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_399){return MakeUnit();},[&](const auto&x_398){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_401){return MakeUnit();},[&](const auto&x_400){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_403){return MakeUnit();},[&](const auto&x_402){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_405){return MakeUnit();},[&](const auto&x_404){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_407){return MakeUnit();},[&](const auto&x_406){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_409){return MakeUnit();},[&](const auto&x_408){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_411){return MakeUnit();},[&](const auto&x_410){return MakeUnit();});OptionMatch(x_271.next,[&](const auto&x_413){return MakeUnit();},[&](const auto&x_412){return MakeUnit();});return MakeUnit();},[&](const auto&x_268){return [&](const auto&x_269){return x_260(MakePair(MakePair(x_267,ListNthExn(x_265.children,x_266)),x_263));};});};});}auto replace_node_x_9(const auto&x_261){return x_260(x_261);}auto x_415(const auto&x_416){auto x_417 = Zro(x_416);auto x_418 = Fst(x_416);auto x_419 = Zro(x_417);auto x_420 = Fst(x_417);return ListMatch(x_419,[&](const auto&x_429){return Panic();},[&](const auto&x_421){return [&](const auto&x_422){return ListMatch(x_422,[&](const auto&x_425){auto x_426 = Zro(x_418);auto x_427 = Fst(x_418);auto x_428 = ListSplitN(x_420.children,x_421);OutputChangeMetric(x_427,IntAdd(layout_size_x_3(ListNthExn(x_420.children,x_421)),layout_size_x_3(x_426)));x_420.children=ListAppend(Zro(x_428),Cons(x_426,ListTailExn(Fst(x_428))));return MakeUnit();},[&](const auto&x_423){return [&](const auto&x_424){return x_415(MakePair(MakePair(x_422,ListNthExn(x_420.children,x_421)),x_418));};});};});}auto replace_layout_node_x_10(const auto&x_416){return x_415(x_416);}auto x_430(const auto&x_431){auto x_432 = Zro(x_431);auto x_433 = Fst(x_431);auto x_434 = Zro(x_432);auto x_435 = Fst(x_432);return ListMatch(x_434,[&](const auto&x_438){auto x_439 = Zro(x_433);auto x_440 = Zro(x_439);auto x_441 = Fst(x_439);auto x_442 = Fst(x_433);auto x_443 = Zro(x_442);auto x_444 = Fst(x_442);InputChangeMetric(x_444,1);std::string x_521 = x_440;if (x_521=="attributes"){std::string x_522 = x_441;if (x_522=="width"){WriteMetric(x_444);HashtblForceRemove(x_435.attr,"width");WriteMetric(x_444);HashtblAddExn(x_435.attr,"width",x_443);return MakeUnit();}else if (x_522=="image_height"){WriteMetric(x_444);HashtblForceRemove(x_435.attr,"image_height");WriteMetric(x_444);HashtblAddExn(x_435.attr,"image_height",x_443);return MakeUnit();}else if (x_522=="image_width"){WriteMetric(x_444);HashtblForceRemove(x_435.attr,"image_width");WriteMetric(x_444);HashtblAddExn(x_435.attr,"image_width",x_443);return MakeUnit();}else if (x_522=="height"){WriteMetric(x_444);HashtblForceRemove(x_435.attr,"height");WriteMetric(x_444);HashtblAddExn(x_435.attr,"height",x_443);return MakeUnit();}else if (x_522=="viewBox"){WriteMetric(x_444);HashtblForceRemove(x_435.attr,"viewBox");WriteMetric(x_444);HashtblAddExn(x_435.attr,"viewBox",x_443);return MakeUnit();}else {return MakeUnit();}}else if (x_521=="properties"){std::string x_523 = x_441;if (x_523=="width"){WriteMetric(x_444);HashtblForceRemove(x_435.prop,"width");WriteMetric(x_444);HashtblAddExn(x_435.prop,"width",x_443);return MakeUnit();}else if (x_523=="flex-grow"){WriteMetric(x_444);HashtblForceRemove(x_435.prop,"flex-grow");WriteMetric(x_444);HashtblAddExn(x_435.prop,"flex-grow",x_443);return MakeUnit();}else if (x_523=="height"){WriteMetric(x_444);HashtblForceRemove(x_435.prop,"height");WriteMetric(x_444);HashtblAddExn(x_435.prop,"height",x_443);return MakeUnit();}else if (x_523=="display"){WriteMetric(x_444);HashtblForceRemove(x_435.prop,"display");WriteMetric(x_444);HashtblAddExn(x_435.prop,"display",x_443);return MakeUnit();}else if (x_523=="position"){WriteMetric(x_444);HashtblForceRemove(x_435.prop,"position");WriteMetric(x_444);HashtblAddExn(x_435.prop,"position",x_443);return MakeUnit();}else if (x_523=="flex-shrink"){WriteMetric(x_444);HashtblForceRemove(x_435.prop,"flex-shrink");WriteMetric(x_444);HashtblAddExn(x_435.prop,"flex-shrink",x_443);return MakeUnit();}else if (x_523=="flex-direction"){WriteMetric(x_444);HashtblForceRemove(x_435.prop,"flex-direction");WriteMetric(x_444);HashtblAddExn(x_435.prop,"flex-direction",x_443);return MakeUnit();}else {return MakeUnit();}}else {return Panic();}},[&](const auto&x_436){return [&](const auto&x_437){return x_430(MakePair(MakePair(x_437,ListNthExn(x_435.children,x_436)),x_433));};});}auto replace_value_x_11(const auto&x_431){return x_430(x_431);}auto x_445(const auto&x_446){auto x_447 = Zro(x_446);auto x_448 = Fst(x_446);auto x_449 = Zro(x_447);auto x_450 = Fst(x_447);return ListMatch(x_449,[&](const auto&x_453){auto x_454 = Zro(x_448);auto x_455 = Zro(x_454);auto x_456 = Fst(x_454);auto x_457 = Fst(x_448);InputChangeMetric(x_457,1);std::string x_524 = x_455;if (x_524=="attributes"){std::string x_525 = x_456;if (x_525=="width"){WriteMetric(x_457);HashtblForceRemove(x_450.attr,"width");return MakeUnit();}else if (x_525=="image_height"){WriteMetric(x_457);HashtblForceRemove(x_450.attr,"image_height");return MakeUnit();}else if (x_525=="image_width"){WriteMetric(x_457);HashtblForceRemove(x_450.attr,"image_width");return MakeUnit();}else if (x_525=="height"){WriteMetric(x_457);HashtblForceRemove(x_450.attr,"height");return MakeUnit();}else if (x_525=="viewBox"){WriteMetric(x_457);HashtblForceRemove(x_450.attr,"viewBox");return MakeUnit();}else {return MakeUnit();}}else if (x_524=="properties"){std::string x_526 = x_456;if (x_526=="width"){WriteMetric(x_457);HashtblForceRemove(x_450.prop,"width");return MakeUnit();}else if (x_526=="flex-grow"){WriteMetric(x_457);HashtblForceRemove(x_450.prop,"flex-grow");return MakeUnit();}else if (x_526=="height"){WriteMetric(x_457);HashtblForceRemove(x_450.prop,"height");return MakeUnit();}else if (x_526=="display"){WriteMetric(x_457);HashtblForceRemove(x_450.prop,"display");return MakeUnit();}else if (x_526=="position"){WriteMetric(x_457);HashtblForceRemove(x_450.prop,"position");return MakeUnit();}else if (x_526=="flex-shrink"){WriteMetric(x_457);HashtblForceRemove(x_450.prop,"flex-shrink");return MakeUnit();}else if (x_526=="flex-direction"){WriteMetric(x_457);HashtblForceRemove(x_450.prop,"flex-direction");return MakeUnit();}else {return MakeUnit();}}else {return Panic();}},[&](const auto&x_451){return [&](const auto&x_452){return x_445(MakePair(MakePair(x_452,ListNthExn(x_450.children,x_451)),x_448));};});}auto delete_value_x_12(const auto&x_446){return x_445(x_446);}auto x_458(const auto&x_459){auto x_460 = Zro(x_459);auto x_461 = Fst(x_459);auto x_462 = Zro(x_460);auto x_463 = Fst(x_460);return ListMatch(x_462,[&](const auto&x_466){auto x_467 = Zro(x_461);auto x_468 = Zro(x_467);auto x_469 = Fst(x_467);auto x_470 = Fst(x_461);auto x_471 = Zro(x_470);auto x_472 = Fst(x_470);InputChangeMetric(x_472,1);std::string x_527 = x_468;if (x_527=="attributes"){std::string x_528 = x_469;if (x_528=="width"){WriteMetric(x_472);HashtblAddExn(x_463.attr,"width",x_471);return MakeUnit();}else if (x_528=="image_height"){WriteMetric(x_472);HashtblAddExn(x_463.attr,"image_height",x_471);return MakeUnit();}else if (x_528=="image_width"){WriteMetric(x_472);HashtblAddExn(x_463.attr,"image_width",x_471);return MakeUnit();}else if (x_528=="height"){WriteMetric(x_472);HashtblAddExn(x_463.attr,"height",x_471);return MakeUnit();}else if (x_528=="viewBox"){WriteMetric(x_472);HashtblAddExn(x_463.attr,"viewBox",x_471);return MakeUnit();}else {return MakeUnit();}}else if (x_527=="properties"){std::string x_529 = x_469;if (x_529=="width"){WriteMetric(x_472);HashtblAddExn(x_463.prop,"width",x_471);return MakeUnit();}else if (x_529=="flex-grow"){WriteMetric(x_472);HashtblAddExn(x_463.prop,"flex-grow",x_471);return MakeUnit();}else if (x_529=="height"){WriteMetric(x_472);HashtblAddExn(x_463.prop,"height",x_471);return MakeUnit();}else if (x_529=="display"){WriteMetric(x_472);HashtblAddExn(x_463.prop,"display",x_471);return MakeUnit();}else if (x_529=="position"){WriteMetric(x_472);HashtblAddExn(x_463.prop,"position",x_471);return MakeUnit();}else if (x_529=="flex-shrink"){WriteMetric(x_472);HashtblAddExn(x_463.prop,"flex-shrink",x_471);return MakeUnit();}else if (x_529=="flex-direction"){WriteMetric(x_472);HashtblAddExn(x_463.prop,"flex-direction",x_471);return MakeUnit();}else {return MakeUnit();}}else {return Panic();}},[&](const auto&x_464){return [&](const auto&x_465){return x_458(MakePair(MakePair(x_465,ListNthExn(x_463.children,x_464)),x_461));};});}auto insert_value_x_13(const auto&x_459){return x_458(x_459);}auto x_473(const auto&x_474){ListIter(ListZip(ListDropLast(x_474.children),ListTl(x_474.children)),[&](const auto&x_475){auto x_476 = Zro(x_475);auto x_477 = Fst(x_475);x_476.parent=Some(x_474);x_476.next=Some(x_477);x_477.prev=Some(x_476);x_473(x_476);return MakeUnit();});return OptionIter(ListLast(x_474.children),[&](const auto&x_478){x_478.parent=Some(x_474);return x_473(x_478);});}auto set_children_relation_x_22(const auto&x_474){return x_473(x_474);}auto eval_stmts_x_25(const auto&x_479){return [&](const auto&x_480){eval_stmts_x_481(x_479)(x_480);ListIter(x_479.children,[&](const auto&x_482){return eval_stmts_x_25(x_482)(x_480);});eval_stmts_x_483(x_479)(x_480);return MakeUnit();};}auto eval_stmts_x_26(const auto&x_484){return [&](const auto&x_485){eval_stmts_x_486(x_484)(x_485);ListIter(x_484.children,[&](const auto&x_487){return eval_stmts_x_26(x_487)(x_485);});return MakeUnit();};}auto x_488(const auto&x_489){ListIter(ListZip(ListDropLast(x_489.children),ListTl(x_489.children)),[&](const auto&x_490){auto x_491 = Zro(x_490);auto x_492 = Fst(x_490);x_491.parent=Some(x_489);x_491.next=Some(x_492);x_492.prev=Some(x_491);x_488(x_491);return MakeUnit();});return OptionIter(ListLast(x_489.children),[&](const auto&x_493){x_493.parent=Some(x_489);return x_488(x_493);});}auto set_children_relation_x_28(const auto&x_489){return x_488(x_489);}auto eval_stmts_x_30(const auto&x_494){return [&](const auto&x_495){eval_stmts_x_496(x_494)(x_495);ListIter(x_494.children,[&](const auto&x_497){return eval_stmts_x_30(x_497)(x_495);});eval_stmts_x_498(x_494)(x_495);return MakeUnit();};}auto eval_stmts_x_31(const auto&x_499){return [&](const auto&x_500){eval_stmts_x_501(x_499)(x_500);ListIter(x_499.children,[&](const auto&x_502){return eval_stmts_x_31(x_502)(x_500);});return MakeUnit();};}auto x_503(const auto&x_504){ListIter(ListZip(ListDropLast(x_504.children),ListTl(x_504.children)),[&](const auto&x_505){auto x_506 = Zro(x_505);auto x_507 = Fst(x_505);x_506.parent=Some(x_504);x_506.next=Some(x_507);x_507.prev=Some(x_506);x_503(x_506);return MakeUnit();});return OptionIter(ListLast(x_504.children),[&](const auto&x_508){x_508.parent=Some(x_504);return x_503(x_508);});}auto set_children_relation_x_35(const auto&x_504){return x_503(x_504);}auto x_509(const auto&x_510){ListIter(ListZip(ListDropLast(x_510.children),ListTl(x_510.children)),[&](const auto&x_511){auto x_512 = Zro(x_511);auto x_513 = Fst(x_511);x_512.parent=Some(x_510);x_512.next=Some(x_513);x_513.prev=Some(x_512);x_509(x_512);return MakeUnit();});return OptionIter(ListLast(x_510.children),[&](const auto&x_514){x_514.parent=Some(x_510);return x_509(x_514);});}auto set_children_relation_x_38(const auto&x_510){return x_509(x_510);}auto x_515(const auto&x_516){ListIter(ListZip(ListDropLast(x_516.children),ListTl(x_516.children)),[&](const auto&x_517){auto x_518 = Zro(x_517);auto x_519 = Fst(x_517);x_518.parent=Some(x_516);x_518.next=Some(x_519);x_519.prev=Some(x_518);x_515(x_518);return MakeUnit();});return OptionIter(ListLast(x_516.children),[&](const auto&x_520){x_520.parent=Some(x_516);return x_515(x_520);});}auto set_children_relation_x_42(const auto&x_516){return x_515(x_516);}int main(){return WithOutFile("hn_type.out",[&](const auto&x_14){PrintEndline("RUNNING FS");return WithInFile("command.json",[&](const auto&x_15){auto x_16 = MakeRef(0);auto x_17 = FreshMetric();auto x_18 = JsonOfString(InputLine(x_15));auto x_19 = JsonOfString(InputLine(x_15));auto x_20 = MakeStack();PushStack(x_20,x_18);PushStack(x_20,x_19);Assert(StringEqual(JsonToString(JsonMember("name",x_18)),"init"));Assert(StringEqual(JsonToString(JsonMember("name",x_19)),"layout_init"));auto x_23 = [&](){auto x_21 = json_to_node_aux_x_0(JsonMember("node",x_18));x_21.parent=None();x_21.prev=None();x_21.next=None();set_children_relation_x_22(x_21);return x_21;}();auto x_24 = json_to_layout_node_x_2(JsonMember("node",x_19));OutputChangeMetric(x_17,layout_size_x_3(x_24));InputChangeMetric(x_17,node_size_x_4(x_23));eval_stmts_x_25(x_23)(x_17);eval_stmts_x_26(x_23)(x_17);JsonToChannel(x_14,AssocToJson(Cons(MakePair("name",StringToJson("FS")),Cons(MakePair("diff_num",IntToJson(ReadRef(x_16))),Cons(MakePair("read_count",IntToJson(MetricReadCount(x_17))),Cons(MakePair("meta_read_count",IntToJson(MetricMetaReadCount(x_17))),Cons(MakePair("write_count",IntToJson(MetricWriteCount(x_17))),Cons(MakePair("meta_write_count",IntToJson(MetricMetaWriteCount(x_17))),Cons(MakePair("queue_size_acc",IntToJson(MetricQueueSizeAcc(x_17))),Cons(MakePair("input_change_count",IntToJson(MetricInputChangeCount(x_17))),Cons(MakePair("output_change_count",IntToJson(MetricOutputChangeCount(x_17))),Cons(MakePair("html",StringToJson("")),Cons(MakePair("command",ListToJson(StackToList(x_20))),Nil())))))))))))));OutputString(x_14,"\n");ResetMetric(x_17);ClearStack(x_20);WriteRef(x_16,IntAdd(ReadRef(x_16),1));auto x_29 = [&](){auto x_27 = node_to_fs_node_x_1(x_23);x_27.parent=None();x_27.prev=None();x_27.next=None();set_children_relation_x_28(x_27);return x_27;}();eval_stmts_x_30(x_29)(FreshMetric());eval_stmts_x_31(x_29)(FreshMetric());AssertNodeValueEqual(x_23,x_29);PrintEndline("EVAL OK!");IterLines(x_15,[&](const auto&x_32){auto x_33 = JsonOfString(x_32);PushStack(x_20,x_33);std::string x_530 = JsonToString(JsonMember("name",x_33));if (x_530=="add"){return add_node_x_5(MakePair(MakePair(ListMap(JsonToList(JsonMember("path",x_33)),[&](const auto&x_36){return JsonToInt(x_36);}),x_23),MakePair([&](){auto x_34 = json_to_node_aux_x_0(JsonMember("node",x_33));x_34.parent=None();x_34.prev=None();x_34.next=None();set_children_relation_x_35(x_34);return x_34;}(),x_17)));}else if (x_530=="recalculate"){eval_stmts_x_25(x_23)(x_17);eval_stmts_x_26(x_23)(x_17);JsonToChannel(x_14,AssocToJson(Cons(MakePair("name",StringToJson("FS")),Cons(MakePair("diff_num",IntToJson(ReadRef(x_16))),Cons(MakePair("read_count",IntToJson(MetricReadCount(x_17))),Cons(MakePair("meta_read_count",IntToJson(MetricMetaReadCount(x_17))),Cons(MakePair("write_count",IntToJson(MetricWriteCount(x_17))),Cons(MakePair("meta_write_count",IntToJson(MetricMetaWriteCount(x_17))),Cons(MakePair("queue_size_acc",IntToJson(MetricQueueSizeAcc(x_17))),Cons(MakePair("input_change_count",IntToJson(MetricInputChangeCount(x_17))),Cons(MakePair("output_change_count",IntToJson(MetricOutputChangeCount(x_17))),Cons(MakePair("html",StringToJson("")),Cons(MakePair("command",ListToJson(StackToList(x_20))),Nil())))))))))))));OutputString(x_14,"\n");ResetMetric(x_17);ClearStack(x_20);WriteRef(x_16,IntAdd(ReadRef(x_16),1));auto x_39 = [&](){auto x_37 = node_to_fs_node_x_1(x_23);x_37.parent=None();x_37.prev=None();x_37.next=None();set_children_relation_x_38(x_37);return x_37;}();eval_stmts_x_30(x_39)(FreshMetric());eval_stmts_x_31(x_39)(FreshMetric());AssertNodeValueEqual(x_23,x_39);return MakeUnit();}else if (x_530=="remove"){return remove_node_x_7(MakePair(MakePair(ListMap(JsonToList(JsonMember("path",x_33)),[&](const auto&x_40){return JsonToInt(x_40);}),x_23),x_17));}else if (x_530=="replace"){return replace_node_x_9(MakePair(MakePair(ListMap(JsonToList(JsonMember("path",x_33)),[&](const auto&x_43){return JsonToInt(x_43);}),x_23),MakePair([&](){auto x_41 = json_to_node_aux_x_0(JsonMember("node",x_33));x_41.parent=None();x_41.prev=None();x_41.next=None();set_children_relation_x_42(x_41);return x_41;}(),x_17)));}else if (x_530=="replace_value"){return replace_value_x_11(MakePair(MakePair(ListMap(JsonToList(JsonMember("path",x_33)),[&](const auto&x_44){return JsonToInt(x_44);}),x_23),MakePair(MakePair(JsonToString(JsonMember("type",x_33)),JsonToString(JsonMember("key",x_33))),MakePair(JsonToValue(JsonMember("value",x_33)),x_17))));}else if (x_530=="delete_value"){return delete_value_x_12(MakePair(MakePair(ListMap(JsonToList(JsonMember("path",x_33)),[&](const auto&x_45){return JsonToInt(x_45);}),x_23),MakePair(MakePair(JsonToString(JsonMember("type",x_33)),JsonToString(JsonMember("key",x_33))),x_17)));}else if (x_530=="insert_value"){return insert_value_x_13(MakePair(MakePair(ListMap(JsonToList(JsonMember("path",x_33)),[&](const auto&x_46){return JsonToInt(x_46);}),x_23),MakePair(MakePair(JsonToString(JsonMember("type",x_33)),JsonToString(JsonMember("key",x_33))),MakePair(JsonToValue(JsonMember("value",x_33)),x_17))));}else if (x_530=="layout_remove"){return remove_layout_node_x_8(MakePair(MakePair(ListMap(JsonToList(JsonMember("path",x_33)),[&](const auto&x_47){return JsonToInt(x_47);}),x_24),x_17));}else if (x_530=="layout_add"){return add_layout_node_x_6(MakePair(MakePair(ListMap(JsonToList(JsonMember("path",x_33)),[&](const auto&x_48){return JsonToInt(x_48);}),x_24),MakePair(json_to_layout_node_x_2(JsonMember("node",x_33)),x_17)));}else if (x_530=="layout_replace"){return replace_layout_node_x_10(MakePair(MakePair(ListMap(JsonToList(JsonMember("path",x_33)),[&](const auto&x_49){return JsonToInt(x_49);}),x_24),MakePair(json_to_layout_node_x_2(JsonMember("node",x_33)),x_17)));}else if (x_530=="layout_info_changed"){return OutputChangeMetric(x_17,1);}else {return Panic();}});PrintEndline("INCREMENTAL EVAL OK!");return MakeUnit();});});}